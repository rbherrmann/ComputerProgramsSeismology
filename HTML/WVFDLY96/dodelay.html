<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>

<meta http-equiv="content-type" content="text/html; charset=ISO-8859-1">
  <title>DODELAY script</title>
</head>
<body bgcolor="#ffffff">
<pre>#!/bin/sh<br><br>#####<br>#   look at the .pre to get the delay in user 9<br>#####<br>VRAYL=3.1<br><br>rm -fr [ZRT].dat<br><br>for COMP in Z R T<br>do<br>rm -f ${COMP}.dat<br>	for PRE in *${COMP}.pre<br>	do<br>		saclhdr -NL -AZ -USER9 ${PRE} &gt;&gt; ${COMP}.dat<br>	done<br>done<br><br><br># -h         (default false) online help<br># Output of wvfdly96 has the following useful parameters for the orgin time and epicenter shift:<br># T0SHIFT= -0.81086242    <br># RSHIFT=   1.9338437    <br># AZSHIFT=   246.66641    <br><br>wvfdly96 &gt; wvfdly96.out<br>AZSHIFT=`grep AZSHIFT wvfdly96.out | awk '{print $2}' `<br>T0SHIFT=`grep T0SHIFT wvfdly96.out | awk '{print $2}' `<br>RSHIFT=`grep RSHIFT wvfdly96.out | awk '{print $2}' `<br><br>cat &gt; awkprg &lt;&lt; EOG<br>{printf "%10.1f %10.1f\n",\$1,  \$2 -1.0*(${T0SHIFT}) }<br>EOG<br>#####<br>#    read the delays again but apply the time offset<br>for COMP in Z R T<br>do<br>rm -f ${COMP}.dat<br>	for PRE in *${COMP}.pre<br>	do<br>		saclhdr -NL -AZ -USER9 ${PRE} &gt;&gt; ${COMP}.dat<br>	done<br>	case ${COMP} in<br>	Z) cat ${COMP}.dat | awk -f awkprg | awk '{printf "%10.1f %10.1f\n",$1,-$2*3.1}' &gt; ${COMP}.dist ;;<br>	T) cat ${COMP}.dat | awk -f awkprg | awk '{printf "%10.1f %10.1f\n",$1,-$2*3.1}' &gt; ${COMP}.dist ;;<br>	T) cat ${COMP}.dat | awk -f awkprg | awk '{printf "%10.1f %10.1f\n",$1,-$2*3.1/0.92}' &gt; ${COMP}.dist ;;<br>	esac<br><br>done<br><br>rm -f cosoff.dat<br>#####<br>#    make a prediction of the theoretical trend fo distance shift<br>#####<br>cat &gt; awkcmd &lt;&lt; EOF<br>{printf "%10.1f %10.1f\n",\$1,  ${RSHIFT} * cos(3.1415927*( \$1 -${AZSHIFT})/180.0)}<br>EOF<br>for AZ in 0 20 40 60 80 100 120 140 160 180 200 220 240 260 280 300 320 340 360<br>do<br>echo ${AZ} | awk -f awkcmd  &gt;&gt; cosoff.dat<br>done<br><br>#####<br>#     set up the command file for genplt to plot the inferred distance offsets from the Z component as Red <br>#     squares, the R component as red circles, the T component as black trianges, and the sinousoidal predicted <br>#     as a black line<br>#####<br>cat &gt; cmdfil &lt;&lt; EOF<br>'Z.dist' 2 0.01 'SQ'<br>'R.dist' 2 0.01 'CI'<br>'T.dist' 1 0.01 'TR'<br>'cosoff.dat' 1 0.01 'NO'<br>EOF<br><br>#####<br>#  Use genplt to plot the delays and predicted delay<br>#<br># USAGE:genplt -XMIN xmin -XMAX xmax -YMIN ymin -YMAX ymax -X0 x0 -Y0 y0 -NOBOX -XLIN _XLOG _YLIN YLOG -XLOG -XLIN -YLOG -YLIN  -C cmdfil -? -h<br># -XMIN xmin (default 0.0)  minimum value of X-Axis<br># -XMAX xmax (default    )  maximum value of X-Axis<br># -YMIN ymin (default 0.0)  minimum value of Y-Axis<br># -YMAX ymax (default 0.0)  maximum value of Y-Axis<br># -X0 x0     (default 2.0)  lower left corner of plot<br># -Y0 y0     (default 1.0)  bottom left corner of plot<br># -XLEN xlen (default 6.0)  length of X-Axis<br># -YLEN ylen (default 6.0)  length of Y-Axis<br># -NOBOX     (default false) do not plot axes<br># -XLIN      (default linear) X axis is linear<br># -XLOG      (default linear) X axis is logarithmic<br># -YLIN      (default linear) Y axis is linear<br># -YLOG      (default linear) Y axis is logarithmic<br># -C cmdfil  (required).<br>#   cmdfil consists of one xy-pair file per line as<br>#     File Kolor Width Psymb     <br>#   File file name of x-y pairs to be plotted<br>#  with the File and Psymb enclosed in single quotes<br>#   Kolor (integer)1=BLACK,1000=red,1050=green,1100=blue 0=white<br>#   Width width of line in inches<br>#   Psymb - a 2 character entry with the following meaning<br>#            SQ - square<br>#            TR - triangle<br>#            HX - heaxgon<br>#            DI - diamond<br>#            CI - circle<br>#            NO - no symbol - plot a line<br>#  There can be multiple -D File Kolor Width Psymb entries<br># -?         (default false) online help<br>#####<br>genplt -XMIN 0 -XMAX 360 -YMIN -30 -YMAX 30 -YLEN 2 -XLEN 6 -C cmdfil -Y0 2.0  -TX 'Azimuth' -TY 'Offset (km )'<br><br>#####<br>#  use calplt for annotate the figure<br>#####<br>calplt -V &lt;&lt; EOF<br>NEWPEN<br>1<br>CENTER<br>5.0 4.2 0.10 'Estimate of location error' 0.0<br>NEWPEN<br>2<br>SFILL<br>'SQ' 0.1 2.0 1.1 <br>NEWPEN<br>1<br>LEFT<br>2.2 1.05 0.10 'Z-Rayl 3.1 km/s' 0.0<br><br>NEWPEN<br>2<br>SFILL<br>'CI' 0.1 4.1 1.1<br>NEWPEN<br>1<br>LEFT<br>4.3 1.05 0.10 'R-Rayl 3.1 km/s' 0.0<br>NEWPEN<br>4<br>SFILL<br>'TR' 0.1 6.2 1.1<br>NEWPEN<br>1<br>LEFT<br>6.4 1.05 0.10 'T-Love 3.5 km/s' 0.0<br>NEWPEN<br>1<br>LINE<br>2.0 0.85 2.2 0.85<br>LEFT<br>2.3 0.8 0.07 'T0shift (km)' 0.0<br>NUMBER<br>3.3 0.8 0.07 ${T0SHIFT} 0.0 1<br>LEFT<br>4.0 0.8 0.07 'AZshift (deg)' 0.0<br>NUMBER<br>5.0 0.8 0.07 ${AZSHIFT} 0.0 1<br>LEFT<br>6.0 0.8 0.07 'Rshift (km)' 0.0<br>NUMBER<br>6.9 0.8 0.07 ${RSHIFT} 0.0 1<br>PEND<br>EOF<br>cat CALPLT.PLT &gt;&gt; GENPLT.PLT<br>#####<br>#    convert the plotfile to EPS<br>#####<br>plotnps -F7 -W10 -EPS -K &lt; GENPLT.PLT &gt;  wdelay.eps<br>#####<br>#    Use GraphicsMagick to convert the EPS to a PNG bit image<br>#####<br>gm convert -trim wdelay.eps wdelay.png<br>rm -f CALPLT.PLT GENPLT.PLT CALPLT.cmd<br><br></pre>
</body>
</html>
